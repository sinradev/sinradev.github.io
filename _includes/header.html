<header class="navbar bg-base-100 shadow-sm">
  <div class="navbar-start">
    <!-- Mobile Menu Dropdown -->
    <div class="dropdown" id="nav-dropdown">
      <button tabindex="0" role="button" class="btn btn-ghost navbar-toggle" aria-label="Toggle navigation menu">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h8m-8 6h16"></path>
        </svg>
      </button>
      <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2 shadow">
        {% for item in site.data[site.active_lang].navigation %}
        {% assign page_url = "/" | append: item.link %}
        {% if item.children %}
        <!-- Mobile dropdown menu -->
        <li class="dropdown">
          <button tabindex="0" role="button" class="{% if page.url == page_url %}active{% endif %} {{ item.klass }}">
            {{ item.name }}
          </button>
          <ul class="dropdown-content menu">
            {% for child in item.children %}
            {% assign child_url = "/" | append: child.link %}
            <li>
              <a href="{% if child.link contains "http" %}{{ child.link }}{% else %}{{ site.baseurl}}/{{ child.link }}{% endif %}"
                 class="{% if page.url == child_url %}active{% endif %}"
                 target="{{ child.target }}"
                 aria-current="{% if page.url == child_url %}page{% else %}false{% endif %}">
                {{ child.name }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </li>
        {% else %}
        <!-- Regular mobile menu item -->
        <li>
          <a href="{% if item.link contains "http" %}{{ item.link }}{% else %}{{ site.baseurl}}/{{ item.link }}{% endif %}"
             class="{% if page.url == page_url %}active{% endif %} {{ item.klass }}"
             target="{{ item.target }}"
             aria-current="{% if page.url == page_url %}page{% else %}false{% endif %}">
            {{ item.name }}
          </a>
        </li>
        {% endif %}
        {% endfor %}
      </ul>
    </div>

    <!-- Logo/Brand -->
    <a href="/" class="btn btn-ghost text-xl navbar-logo">
      <img src="/assets/images/sinra-logo.svg" alt="Sinra Logo" width="40" height="40" />
      <span>Sinra</span>
    </a>
  </div>

  <div class="navbar-center navbar-menu">
    <ul class="menu menu-horizontal px-1">
      {% for item in site.data[site.active_lang].navigation %}
      {% assign page_url = "/" | append: item.link %}
      {% if item.children %}
      <!-- Dropdown menu -->
      <li class="dropdown">
        <button tabindex="0" role="button" class="{% if page.url == page_url %}active{% endif %} {{ item.klass }}">
          {{ item.name }}
        </button>
        <ul class="dropdown-content menu">
          {% for child in item.children %}
          {% assign child_url = "/" | append: child.link %}
          <li>
            <a href="{% if child.link contains "http" %}{{ child.link }}{% else %}{{ site.baseurl}}/{{ child.link }}{% endif %}"
               class="{% if page.url == child_url %}active{% endif %}"
               target="{{ child.target }}"
               aria-current="{% if page.url == child_url %}page{% else %}false{% endif %}">
              {{ child.name }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </li>
      {% else %}
      <!-- Regular menu item -->
      <li>
        <a href="{% if item.link contains "http" %}{{ item.link }}{% else %}{{ site.baseurl}}/{{ item.link }}{% endif %}"
           class="{% if page.url == page_url %}active{% endif %} {{ item.klass }}"
           target="{{ item.target }}"
           aria-current="{% if page.url == page_url %}page{% else %}false{% endif %}">
          {{ item.name }}
        </a>
      </li>
      {% endif %}
      {% endfor %}
    </ul>
  </div>

  <div class="navbar-end">
    <!-- Language Switcher Dropdown -->
    <div class="dropdown dropdown-end">
      <button tabindex="0" role="button" class="btn btn-ghost btn-sm" id="lang-button">
        EN
      </button>
      <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-[1] w-32 p-2 shadow" id="lang-dropdown">
        {% for tongue in site.languages %}
        <li>
          <a {% static_href %}href="{% if tongue == site.default_lang %}{{site.baseurl}}{{page.url}}{% else %}{{site.baseurl}}/{{ tongue }}{{page.url}}{% endif %}"{% endstatic_href %}
             data-lang="{{ tongue }}">
            {{ tongue | upcase }}
          </a>
        </li>
        {% endfor %}
      </ul>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var path = window.location.pathname;
        var currentLang = 'en';

        // Detect language from URL path
        if (path.indexOf('/fr') === 0 || path.indexOf('/fr/') === 0) {
          currentLang = 'fr';
        } else if (path.indexOf('/es') === 0 || path.indexOf('/es/') === 0) {
          currentLang = 'es';
        }

        // Update button text
        var button = document.getElementById('lang-button');
        if (button) button.textContent = currentLang.toUpperCase();

        // Update active state
        var links = document.querySelectorAll('#lang-dropdown a');
        links.forEach(function(link) {
          link.classList.remove('active');
          if (link.getAttribute('data-lang') === currentLang) {
            link.classList.add('active');
          }
        });
      });
    </script>
  </div>
</header>
